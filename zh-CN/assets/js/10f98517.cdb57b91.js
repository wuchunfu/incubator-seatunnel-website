"use strict";(self.webpackChunkseatunnel_website=self.webpackChunkseatunnel_website||[]).push([[6864],{3905:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return h}});var o=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,o,a=function(e,n){if(null==e)return{};var t,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=o.createContext({}),c=function(e){var n=o.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=c(e.components);return o.createElement(l.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},d=o.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=c(t),h=a,f=d["".concat(l,".").concat(h)]||d[h]||p[h]||r;return t?o.createElement(f,i(i({ref:n},u),{},{components:t})):o.createElement(f,i({ref:n},u))}));function h(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,i=new Array(r);i[0]=d;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var c=2;c<r;c++)i[c]=t[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,t)}d.displayName="MDXCreateElement"},74794:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return c},assets:function(){return u},toc:function(){return p},default:function(){return h}});var o=t(87462),a=t(63366),r=(t(67294),t(3905)),i=["components"],s={sidebar_position:7},l=void 0,c={unversionedId:"seatunnel-engine/checkpoint-storage",id:"seatunnel-engine/checkpoint-storage",title:"checkpoint-storage",description:"----------------",source:"@site/docs/seatunnel-engine/checkpoint-storage.md",sourceDirName:"seatunnel-engine",slug:"/seatunnel-engine/checkpoint-storage",permalink:"/zh-CN/docs/seatunnel-engine/checkpoint-storage",editUrl:"https://github.com/apache/incubator-seatunnel-website/edit/main/docs/seatunnel-engine/checkpoint-storage.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7},sidebar:"docs",previous:{title:"savepoint",permalink:"/zh-CN/docs/seatunnel-engine/savepoint"},next:{title:"rest-api",permalink:"/zh-CN/docs/seatunnel-engine/rest-api"}},u={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Checkpoint Storage",id:"checkpoint-storage-1",level:3},{value:"Checkpoint Storage Configuration",id:"checkpoint-storage-configuration",level:3},{value:"OSS",id:"oss",level:4},{value:"S3",id:"s3",level:4},{value:"HDFS",id:"hdfs",level:4},{value:"LocalFile",id:"localfile",level:4}],d={toc:p};function h(e){var n=e.components,t=(0,a.Z)(e,i);return(0,r.kt)("wrapper",(0,o.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("hr",null),(0,r.kt)("h1",{id:"checkpoint-storage"},"Checkpoint Storage"),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"Checkpoint is a fault-tolerant recovery mechanism. This mechanism ensures that when the program is running, it can recover itself even if it suddenly encounters an exception."),(0,r.kt)("h3",{id:"checkpoint-storage-1"},"Checkpoint Storage"),(0,r.kt)("p",null,"Checkpoint Storage is a storage mechanism for storing checkpoint data."),(0,r.kt)("p",null,"SeaTunnel Engine supports the following checkpoint storage types:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"HDFS (OSS,S3,HDFS,LocalFile)"),(0,r.kt)("li",{parentName:"ul"},"LocalFile (native), (it's deprecated: use Hdfs(LocalFile) instead.")),(0,r.kt)("p",null,"We used the microkernel design pattern to separate the checkpoint storage module from the engine. This allows users to implement their own checkpoint storage modules."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"checkpoint-storage-api")," is the checkpoint storage module API, which defines the interface of the checkpoint storage module."),(0,r.kt)("p",null,"if you want to implement your own checkpoint storage module, you need to implement the ",(0,r.kt)("inlineCode",{parentName:"p"},"CheckpointStorage")," and provide the corresponding ",(0,r.kt)("inlineCode",{parentName:"p"},"CheckpointStorageFactory")," implementation."),(0,r.kt)("h3",{id:"checkpoint-storage-configuration"},"Checkpoint Storage Configuration"),(0,r.kt)("p",null,"The configuration of the ",(0,r.kt)("inlineCode",{parentName:"p"},"seatunnel-server")," module is in the ",(0,r.kt)("inlineCode",{parentName:"p"},"seatunnel.yaml")," file."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"\nseatunnel:\n    engine:\n        checkpoint:\n            storage:\n                type: hdfs #plugin name of checkpoint storage, we support hdfs(S3, local, hdfs), localfile (native local file) is the default, but this plugin is de\n              # plugin configuration\n                plugin-config: \n                  namespace: #checkpoint storage parent path, the default value is /seatunnel/checkpoint/\n                  K1: V1 # plugin other configuration\n                  K2: V2 # plugin other configuration   \n")),(0,r.kt)("p",null,'Notice: namespace must end with "/".'),(0,r.kt)("h4",{id:"oss"},"OSS"),(0,r.kt)("p",null,"Aliyun oss base on hdfs-file, so you can refer ",(0,r.kt)("a",{parentName:"p",href:"https://hadoop.apache.org/docs/stable/hadoop-aliyun/tools/hadoop-aliyun/index.html"},"hadoop oss docs")," to config oss."),(0,r.kt)("p",null,"Except when interacting with oss buckets, the oss client needs the credentials needed to interact with buckets.\nThe client supports multiple authentication mechanisms and can be configured as to which mechanisms to use, and their order of use. Custom implementations of org.apache.hadoop.fs.aliyun.oss.AliyunCredentialsProvider may also be used.\nif you used AliyunCredentialsProvider (can be obtained from the Aliyun Access Key Management), these consist of an access key, a secret key.\nyou can config like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"seatunnel:\n  engine:\n    checkpoint:\n      interval: 6000\n      timeout: 7000\n      max-concurrent: 1\n      tolerable-failure: 2\n      storage:\n        type: hdfs\n        max-retained: 3\n        plugin-config:\n          storage.type: oss\n          oss.bucket: your-bucket\n          fs.oss.accessKeyId: your-access-key\n          fs.oss.accessKeySecret: your-secret-key\n          fs.oss.endpoint: endpoint address\n          fs.oss.credentials.provider: org.apache.hadoop.fs.aliyun.oss.AliyunCredentialsProvider\n")),(0,r.kt)("p",null,"For additional reading on the Hadoop Credential Provider API see: ",(0,r.kt)("a",{parentName:"p",href:"https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/CredentialProviderAPI.html"},"Credential Provider API"),"."),(0,r.kt)("p",null,"Aliyun oss Credential Provider implements see: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/aliyun/aliyun-oss-java-sdk/tree/master/src/main/java/com/aliyun/oss/common/auth"},"Auth Credential Providers")),(0,r.kt)("h4",{id:"s3"},"S3"),(0,r.kt)("p",null,"S3 base on hdfs-file, so you can refer ",(0,r.kt)("a",{parentName:"p",href:"https://hadoop.apache.org/docs/stable/hadoop-aws/tools/hadoop-aws/index.html"},"hadoop s3 docs")," to config s3."),(0,r.kt)("p",null,"Except when interacting with public S3 buckets, the S3A client needs the credentials needed to interact with buckets.\nThe client supports multiple authentication mechanisms and can be configured as to which mechanisms to use, and their order of use. Custom implementations of com.amazonaws.auth.AWSCredentialsProvider may also be used.\nif you used SimpleAWSCredentialsProvider (can be obtained from the Amazon Security Token Service), these consist of an access key, a secret key.\nyou can config like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"``` yaml\n\nseatunnel:\n    engine:\n        checkpoint:\n            interval: 6000\n            timeout: 7000\n            max-concurrent: 1\n            tolerable-failure: 2\n            storage:\n                type: hdfs\n                max-retained: 3\n                plugin-config:\n                    storage.type: s3\n                    s3.bucket: your-bucket\n                    fs.s3a.access.key: your-access-key\n                    fs.s3a.secret.key: your-secret-key\n                    fs.s3a.aws.credentials.provider: org.apache.hadoop.fs.s3a.SimpleAWSCredentialsProvider\n                    \n\n")),(0,r.kt)("p",null,"if you used ",(0,r.kt)("inlineCode",{parentName:"p"},"InstanceProfileCredentialsProvider"),", this supports use of instance profile credentials if running in an EC2 VM, you could check ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/zh_cn/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html"},"iam-roles-for-amazon-ec2"),".\nyou can config like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"\nseatunnel:\n  engine:\n    checkpoint:\n      interval: 6000\n      timeout: 7000\n      max-concurrent: 1\n      tolerable-failure: 2\n      storage:\n        type: hdfs\n        max-retained: 3\n        plugin-config:\n          storage.type: s3\n          s3.bucket: your-bucket\n          fs.s3a.endpoint: your-endpoint\n          fs.s3a.aws.credentials.provider: org.apache.hadoop.fs.s3a.InstanceProfileCredentialsProvider\n")),(0,r.kt)("p",null,"For additional reading on the Hadoop Credential Provider API see: ",(0,r.kt)("a",{parentName:"p",href:"https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/CredentialProviderAPI.html"},"Credential Provider API"),"."),(0,r.kt)("h4",{id:"hdfs"},"HDFS"),(0,r.kt)("p",null,"if you used HDFS, you can config like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"seatunnel:\n  engine:\n    checkpoint:\n      storage:\n        type: hdfs\n        max-retained: 3\n        plugin-config:\n          storage.type: hdfs\n          fs.defaultFS: hdfs://localhost:9000\n          // if you used kerberos, you can config like this:\n          kerberosPrincipal: your-kerberos-principal\n          kerberosKeytab: your-kerberos-keytab  \n")),(0,r.kt)("h4",{id:"localfile"},"LocalFile"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"seatunnel:\n  engine:\n    checkpoint:\n      interval: 6000\n      timeout: 7000\n      max-concurrent: 1\n      tolerable-failure: 2\n      storage:\n        type: hdfs\n        max-retained: 3\n        plugin-config:\n          storage.type: hdfs\n          fs.defaultFS: file:/// # Ensure that the directory has written permission \n\n")))}h.isMDXComponent=!0}}]);